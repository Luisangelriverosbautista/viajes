# Netlify Configuration - Viajes de Estudio dApp
# Next.js 14 + Stellar Blockchain Integration
# Build: 2025-12-09 - EROFS graceful handling

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build]
  # Base directory (where package.json is)
  base = "SOROBAN/proyecto-viajes-de-estudio/frontend"
  
  # Build command: install with devDependencies, then build
  command = "npm install --legacy-peer-deps --include=dev && npm run build"
  
  # Let plugin-nextjs handle the output
  publish = ".next"
  
  # Include Node modules in cache (faster builds)
  ignore = "git diff --quiet HEAD^ HEAD -- SOROBAN/proyecto-viajes-de-estudio/frontend"

[build.environment]
  NODE_VERSION = "20.9.0"
  NODE_ENV = "production"

# Environment variables for production
[context.production.environment]
  NEXT_PUBLIC_NETWORK = "testnet"
  NEXT_PUBLIC_RPC_URL = "https://soroban-testnet.stellar.org"
  NEXT_PUBLIC_SOROBAN_RPC_URL = "https://soroban-testnet.stellar.org"
  NEXT_PUBLIC_HORIZON_URL = "https://horizon-testnet.stellar.org"
  NEXT_PUBLIC_NETWORK_PASSPHRASE = "Test SDF Network ; September 2015"
  NEXT_PUBLIC_STELLAR_NETWORK = "testnet"
  NEXT_PUBLIC_STELLAR_RPC_URL = "https://soroban-testnet.stellar.org"
  NEXT_PUBLIC_CONTRACT_ADDRESS = "CBELUS7MVYDXFKB3262ZRCZ5RR3EG3HG4FJ3L6OLSO3JJNVVT43V2NBF"
  NEXT_PUBLIC_TOKEN_CONTRACT_ID = "CA7N7ME5RCXHM3YOCM3YTM5FTKRIPVAJAEZWKLUJNINDQZQV73GNCHAA"
  NEXT_PUBLIC_FREIGHTER_API_ENABLED = "true"
  NEXT_PUBLIC_APP_NAME = "Soroban Passkey Demo - Viajes de Estudio"
  NEXT_PUBLIC_DEV_MODE = "false"
  NEXT_PUBLIC_DEBUG = "false"

# Headers for WebAuthn/Freighter support
[[headers]]
  for = "/*"
  [headers.values]
    Cross-Origin-Opener-Policy = "same-origin"
    Cross-Origin-Embedder-Policy = "require-corp"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"

# Redirect all 404s to index.html for Next.js client-side routing
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false

# API routes (Next.js handles these automatically)
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200
  force = false
